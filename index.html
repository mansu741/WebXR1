<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/loaders/GLTFLoader.js"></script>
</head>
<body style="margin:0; overflow:hidden;">

<button id="enter-ar" style="
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  padding: 12px 20px;
  background: #00A2FF;
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 18px;
">
AR ì‹œì‘
</button>

<script>
let xrSession, renderer, scene, camera;
let reticle;  // ë°”ë‹¥ hit-testìš©
let model = null;

async function init() {
    


    renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true });
    renderer.xr.enabled = true;
    document.body.appendChild(renderer.domElement);

    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera();

    // ê¸°ë³¸ ì¡°ëª… ì¶”ê°€ (ì—†ìœ¼ë©´ ëª¨ë¸ì´ ê¹œê¹œí•˜ê²Œ ë³´ì„)
    const ambient = new THREE.AmbientLight(0xffffff, 1.5);
    scene.add(ambient);

    const dir = new THREE.DirectionalLight(0xffffff, 1.2);
    dir.position.set(1, 3, 2);
    scene.add(dir);

    // ë°”ë‹¥ ì°¾ê¸°ìš© reticle
    reticle = new THREE.Mesh(
        new THREE.RingGeometry(0.1, 0.12, 32).rotateX(-Math.PI/2),
        new THREE.MeshBasicMaterial({ color: 0x00ff00 })
    );
    reticle.visible = false;
    scene.add(reticle);

    // glb ë¡œë”©
    const loader = new THREE.GLTFLoader();
    loader.load('./model.glb', (gltf)=>{
        model = gltf.scene;
        model.visible = false;
        model.scale.set(0.03, 0.03, 0.03);
        scene.add(model);
    });

    document.getElementById("enter-ar").onclick = activateAR;
}

async function activateAR() {

    xrSession = await navigator.xr.requestSession("immersive-ar", {
        requiredFeatures: ["hit-test", "dom-overlay"],
        domOverlay: { root: document.body }
    });

    renderer.xr.setSession(xrSession);

    const refSpace = await xrSession.requestReferenceSpace("local");
    const viewerSpace = await xrSession.requestReferenceSpace("viewer");
    const hitTestSource = await xrSession.requestHitTestSource({ space: viewerSpace });

    xrSession.requestAnimationFrame(function loop(t, frame) {

        const state = frame.getViewerPose(refSpace);

        if (state) {
            const results = frame.getHitTestResults(hitTestSource);

            if (results.length > 0) {
                const hit = results[0];
                const pose = hit.getPose(refSpace);

                // reticle ë°”ë‹¥ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
                    reticle.visible = true;
                    reticle.position.copy(pose.transform.position);

                // ëª¨ë¸ ë°°ì¹˜
                    if (!model.visible) {
                        model.visible = true;

                        // ğŸ”¥ ëª¨ë¸ì„ ë°”ë‹¥ì— ì •í™•í•˜ê²Œ ë¶™ì´ê¸°
                        model.position.set(
                        reticle.position.x,
                        reticle.position.y,
                        reticle.position.z
        );

        // ë˜ëŠ” ë” ì •í™•í•˜ê²Œ í•˜ë©´ â†’ model.position.copy(reticle.position);
    }
}

            }
        }

        renderer.render(scene, camera);
        xrSession.requestAnimationFrame(loop);
    });
}

init();
</script>
</body>
</html>



